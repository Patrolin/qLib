
*[]TestSuite test_suites = [{""}] // TODO: who allocates this?

TestSuite {
  str name
  uint passed = 0
  uint failed = 0
  uint total() {
    return self.passed + self.failed
  }

  enter() {
    test_suites.append(this)
  }
  exit() {
    test_suites.pop()
  }
}

bool all(bool[] X) {
  return reduce(X, true, acc & condition)
}

bool test([]bool conditions, bool quiet = false) {
  bool passed = reduce(conditions, true, acc & it)
  if passed {
    for(test_suites, it.passed += 1)
  } else {
    for(test_suites, it.failed += 1)
    if !quiet {
      print("%#% failed:", [test_suites[1:].map(x => x.name).join('.'), test_suites[test_suites.len-1].total()])
      print("value = %", conditions)
    }
  }
}
